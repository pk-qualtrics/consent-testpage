<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ketch Consent Example</title>

  <!-- Your existing Ketch tag (v2) -->
  <script>
    !function(){
      window.semaphore=window.semaphore||[];
      window.ketch=function(){
        window.semaphore.push(arguments)
      };
      var n=document.createElement("script");
      n.type="text/javascript",
      n.src="https://global.ketchcdn.com/web/v2/config/merkle/website_smart_tag/boot.js",
      n.defer=n.async=!0,
      document.getElementsByTagName("head")[0].appendChild(n)
    }();
  </script>

  <!-- Your custom consent callback -->
  <script>
    // Poll for the real Ketch object to become available
    function waitForKetch(callback) {
      const interval = setInterval(() => {
        if (typeof window.ketch === 'object' && typeof window.ketch.onConsent === 'function') {
          clearInterval(interval);
          callback(window.ketch);
        }
      }, 100);
    }

    waitForKetch((ketch) => {
      ketch.onConsent((consent) => {
        if (consent?.purposes?.analytics === 'consented') {
          console.log('User gave consent for analytics');

          // Run your custom code
          myCustomFunction();
        }
      });
    });

    // Example custom function
    function myCustomFunction() {
      console.log('Running custom post-consent code...');
      // Example: Load Google Analytics
      loadAnalytics();
    }

    function loadAnalytics() {
      const script = document.createElement('script');
      script.src = 'https://www.googletagmanager.com/gtag/js?id=YOUR_ANALYTICS_ID';
      script.async = true;
      script.onload = function () {
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'YOUR_ANALYTICS_ID');
      };
      document.head.appendChild(script);
    }
  </script>
</head>
<body>
  <h1>Welcome to Our Site! 2</h1>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ketch Consent Example</title>

  <!-- Your Ketch boot script (unchanged) -->
<script>!function(){window.semaphore=window.semaphore||[],window.ketch=function(){window.semaphore.push(arguments)};var e=document.createElement("script");e.type="text/javascript",e.src="https://global.ketchcdn.com/web/v3/config/merkle/website_smart_tag/boot.js",e.defer=e.async=!0,document.getElementsByTagName("head")[0].appendChild(e)}();</script>

<script>
let checkAttempts = 0;
const maxAttempts = 100; // 100 attempts Ã— 100ms = 10 seconds

function waitForKetchApi() {
  console.log('Checking for ketchApi... Attempt:', checkAttempts);

  if (window.ketchApi && window.ketchApi.consents) {
    console.log('ketchApi is ready', window.ketchApi.consents);
    handleConsent();
  } else if (checkAttempts < maxAttempts) {
    checkAttempts++;
    setTimeout(waitForKetchApi, 100);
  } else {
    console.warn('Ketch API not available after 10 seconds. Giving up.');
  }
}

function handleConsent() {
  const consents = window.ketchApi.consents;
  if (consents?.purposes['essential']?.status === 'granted') {
    console.log('Essential consent granted');
    loadCustomFunction();
  } else {
    console.log('Essential consent NOT granted');
  }
}

function loadCustomFunction() {
  console.log("Custom function called - Essential consent granted!");
  // Your GA or other tracking code here
}

// Start checking
waitForKetchApi();
</script>



</head>
<body>
  <h1>Welcome! 5</h1>
</body>
</html>
